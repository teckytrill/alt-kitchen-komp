<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kitchen - Kitchen Kompanion</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@100..900&family=Plaster&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="style/main.css" />
</head>
<body>
  <div class="ipad-frame">
    <button class="logout-btn" onclick="logoutUser()">🚪 Logout</button>
    <div class="ipad-camera"></div>

    <!-- Header -->
    <header class="app-header">
      <div class="header-content">
        <h2>K</h2>
        <h3>My Pantry</h3>
      </div>
    </header>


    <main class="app-content">

      <!-- Location Tabs -->
      <div class="location-tabs">
        <button class="location-btn active" data-location="Fridge">🧊 Fridge</button>
        <button class="location-btn" data-location="Pantry">🥫 Pantry</button>
        <button class="location-btn" data-location="Freezer">❄️ Freezer</button>
        <button class="location-btn" data-location="none">🔎 All Pantry Items</button> <!-- New filter -->
      </div>

      <!-- Inventory Form -->
      <form id="inventory-form">
        <input type="text" id="item-name" placeholder="Item name" required />
        <input type="number" id="item-qty" placeholder="Qty" required />
        <select id="item-unit">
          <option value="pcs">pcs</option>
          <option value="kg">kg</option>
          <option value="g">g</option>
          <option value="cups">cups</option>
          <option value="liters">liters</option>
        </select>
        <button type="submit">Add Item</button>
      </form>

      <!-- Inventory Display -->
      <div class="inventory-scroll-container">
        <ul id="inventory-list" class="inventory-list"></ul>
      </div>
    </main>

    <nav class="app-navbar">
      <a href="shoppinglist.html"><img src="icons/shoppinglist.svg" alt="Shopping List" /></a>
      <a href="kitchen.html"><img src="icons/kitchen.svg" alt="Kitchen" /></a>
      <a href="recipes.html"><img src="icons/recipes.svg" alt="Recipes" /></a>
      <a href="profile.html"><img src="icons/profile.svg" alt="Profile" /></a>
    </nav>
  </div>
  <script>
    const username = "amman123"; // Use the current logged-in username
  
    if (!username) {
      alert("You must log in first.");
      window.location.href = "login.html";
    }
  
    let inventory = []; // To store kitchen inventory for the user
    let currentLocation = 'Fridge'; // Default location is Fridge

    // Fetch user data from the API
    async function fetchUserData() {
      try {
        const response = await fetch(`http://localhost:3000/api/users/${username}`);
        if (!response.ok) {
          throw new Error('User data not found');
        }
        const data = await response.json();
        inventory = data.pantry || []; // Assuming `data.pantry` is your list of pantry items
        renderInventory();
      } catch (error) {
        console.error(error);
        alert("Failed to load user data.");
      }
    }

    // Location change logic
    const locationButtons = document.querySelectorAll('.location-btn');
    locationButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        locationButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentLocation = btn.dataset.location;
        renderInventory(); // Re-render the inventory for the selected location
      });
    });

    // Render inventory based on the current location
    function renderInventory() {
      const inventoryList = document.getElementById('inventory-list');
      inventoryList.innerHTML = '';

      // Filter the items based on the current location (including 'none' for showing all items)
      const filtered = inventory
        .map((item, index) => ({ ...item, index }))
        .filter(item => currentLocation === 'none' || item.storage === currentLocation || !item.storage); // Show all if 'none' is selected

      filtered.forEach(({ name, quantity, storage, index }) => {
        const li = document.createElement('li');
        li.innerHTML = `
          <span>${quantity} — ${name}${storage ? ` (Stored in: ${storage})` : ''}</span>
          <button onclick="removeItem(${index})">🗑</button>
        `;
        inventoryList.appendChild(li);
      });
    }

    // Remove item from inventory
    function removeItem(index) {
      inventory.splice(index, 1);
      updateUserData(); // Update the server with new inventory
      renderInventory();
    }

    // Initial user data fetch
    fetchUserData();

  
    // Logout logic
    function logoutUser() {
      localStorage.removeItem("activeUser");
      window.location.href = "login.html";
    }
  </script>
</body>
</html>
